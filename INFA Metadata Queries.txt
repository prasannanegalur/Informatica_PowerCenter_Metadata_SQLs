-- Session Parameter File

SELECT 
D.SUBJ_NAME FOLDER_NAME,
A.TASK_NAME WORKFLOW_NAME,
C.TASK_NAME SESSION_NAME,
ATTR_VALUE
FROM OPB_TASK A,
OPB_TASK_ATTR B, 
OPB_TASK C, 
OPB_SUBJECT D
WHERE C.TASK_ID=B.TASK_ID
AND C.TASK_TYPE=B.TASK_TYPE
AND C.RU_PARENT_ID=A.TASK_ID AND C.TASK_TYPE = 68 AND A.SUBJECT_ID = C.SUBJECT_ID
AND D.SUBJ_ID = A.SUBJECT_ID
AND ATTR_ID = 4
AND SUBJ_NAME = '<Folder_Name>'
AND ATTR_VALUE IS NOT NULL

-- Session Log

SELECT  
A.WORKFLOW_NAME,A.WORKFLOW_ID,
A.START_TIME AS WORKFLOW_START_TIME,
A.END_TIME AS WORKFLOW_END_TIME,
B.INSTANCE_NAME AS SESSION_NAME,
C.MAPPING_NAME,
B.START_TIME AS SESS_START_TIME,
B.END_TIME AS SESS_END_TIME,
C.SRC_SUCCESS_ROWS,
C.SRC_FAILED_ROWS,
C.TARG_SUCCESS_ROWS,
C.TARG_FAILED_ROWS
FROM OPB_WFLOW_RUN A,
OPB_TASK_INST_RUN B,
OPB_SESS_TASK_LOG C
WHERE B.TASK_TYPE=68 AND
A.WORKFLOW_ID=B.WORKFLOW_ID 
AND A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID
AND B.WORKFLOW_RUN_ID=C.WORKFLOW_RUN_ID
AND B.WORKFLOW_ID=C.WORKFLOW_ID 
AND B.INSTANCE_ID=C.INSTANCE_ID
AND A.WORKFLOW_NAME= ''

-- Search for Connection object/connect string

SELECT 
C.SUBJ_NAME FOLDER_NAME,
B.TASK_NAME WORKFLOW_NAME,
A.TASK_NAME SESSION_NAME,
OBJECT_NAME CONNECTION_NAME
FROM OPB_TASK A 
INNER JOIN OPB_TASK B ON A.RU_PARENT_ID=B.TASK_ID AND A.TASK_TYPE = 68
INNER JOIN OPB_SUBJECT C ON C.SUBJ_ID = B.SUBJECT_ID
INNER JOIN OPB_SESS_CNX_VALS G ON G.SESSION_ID = A.TASK_ID
INNER JOIN OPB_CNX H ON H.OBJECT_ID = G.CONNECTION_ID
INNER JOIN OPB_CNX_ATTR I ON H.OBJECT_ID = I.OBJECT_ID
WHERE UPPER(H.CONNECT_STRING) LIKE '%SMART%'
OR UPPER(I.ATTR_VALUE) LIKE '%SMART%'
ORDER BY 1,2,3,4


SELECT 
C.SUBJ_NAME FOLDER_NAME,
B.TASK_NAME WORKFLOW_NAME,
A.TASK_NAME SESSION_NAME,
H.OBJECT_NAME CONNECTION_NAME,
CASE H.OBJECT_SUBTYPE WHEN 103 THEN 'MLoad'
WHEN 104 THEN 'TPump'
WHEN 107 THEN 'FastLoad' END CONNECTION_TYPE,
I.ATTR_VALUE CHECK_POINT
FROM OPB_TASK A 
INNER JOIN OPB_TASK B ON A.RU_PARENT_ID=B.TASK_ID AND A.TASK_TYPE = 68
INNER JOIN OPB_SUBJECT C ON C.SUBJ_ID = B.SUBJECT_ID
INNER JOIN OPB_SESS_CNX_VALS G ON G.SESSION_ID = A.TASK_ID
INNER JOIN OPB_CNX H ON H.OBJECT_ID = G.CONNECTION_ID
INNER JOIN OPB_CNX_ATTR I ON H.OBJECT_ID = I.OBJECT_ID
WHERE H.OBJECT_TYPE = 76
AND H.OBJECT_SUBTYPE IN (103,104,107) -- 103 : Mload, 104 : Tpump, 107 : Fastload
AND I.ATTR_ID = 5
ORDER BY 1,2,3,4



SELECT 
C.SUBJ_NAME FOLDER_NAME,
B.TASK_NAME WORKFLOW_NAME,
A.TASK_NAME SESSION_NAME,
OBJECT_NAME CONNECTION_NAME,
START_TIME+DELTA_VALUE/86400 NEXT_SCHEDULE
FROM OPB_TASK A 
INNER JOIN OPB_TASK B ON A.RU_PARENT_ID=B.TASK_ID AND A.TASK_TYPE = 68
INNER JOIN OPB_SUBJECT C ON C.SUBJ_ID = B.SUBJECT_ID
INNER JOIN OPB_SESS_CNX_VALS G ON G.SESSION_ID = A.TASK_ID
INNER JOIN OPB_CNX H ON H.OBJECT_ID = G.CONNECTION_ID
INNER JOIN OPB_WORKFLOW W ON W.WORKFLOW_ID = B.TASK_ID
INNER JOIN OPB_SCHEDULER S ON W.SCHEDULER_ID = S.SCHEDULER_ID
INNER JOIN (SELECT WORKFLOW_ID,MAX(START_TIME) START_TIME FROM OPB_WFLOW_RUN GROUP BY WORKFLOW_ID) R ON R.WORKFLOW_ID = W.WORKFLOW_ID
WHERE  C.SUBJ_NAME=''
AND H.CONNECT_STRING LIKE '%%'
AND S.RUN_OPTIONS IN (4,32)
AND S.END_OPTIONS = 2
ORDER BY 1,2,3,4


command task info - 

select 
c.subj_name as Folder,
b.task_name as Workflow,
a.task_name as CommandTask,
e.pm_value as Command
from
OPB_TASK A,
OPB_TASK B,
OPB_SUBJECT C,
OPB_TASK_VAL_LIST E
WHERE a.ru_parent_id = b.task_id
and a.task_id = e.task_id
and a.subject_id = c.subj_id
and a.task_type = 58
and e.pm_value like '%%'
order by 1,2,3,4

SELECT 
DISTINCT F.SUBJ_NAME,W.TASK_NAME WF ,/*S.TASK_NAME SESS,*/
COUNT(DISTINCT W.TASK_ID) OVER(PARTITION BY W.SUBJECT_ID) AS WF_COUNT,
COUNT(DISTINCT S.TASK_ID) OVER(PARTITION BY W.SUBJECT_ID,W.TASK_ID) AS SESS_COUNT
FROM OPB_TASK_INST S
INNER JOIN OPB_TASK X ON X.TASK_ID = S.TASK_ID
INNER JOIN OPB_TASK W ON X.RU_PARENT_ID = W.TASK_ID
INNER JOIN OPB_SUBJECT F ON F.SUBJ_ID = W.SUBJECT_ID
INNER JOIN OPB_TASK_VAL_LIST L ON S.TASK_ID = L.TASK_ID
WHERE S.TASK_TYPE = 58 
AND S.IS_ENABLED = 1 
AND W.TASK_TYPE = 71
and w.task_name = ''
AND (UPPER(L.PM_VALUE) LIKE '%.SH%' OR UPPER(L.PM_VALUE) LIKE '%.KSH%')


session Log : 

select 
C.SUBJ_NAME,b.task_name,A.TASK_NAME,g.attr_value
from OPB_TASK A 
inner join OPB_TASK B on A.ru_parent_id=B.task_id and a.TASK_TYPE = 68
inner join OPB_TASK_INST D on A.task_id=D.task_id
inner join OPB_SUBJECT C on C.SUBJ_NAME=''
and B.TASK_NAME IN ()
inner join OPB_TASK_ATTR g on g.task_id = a.task_id
and g.attr_id = 2
order by 1,2,3,4


select 
subj_name,
wf.task_name workflow_name,
t.task_name session_name,
m.mapping_name,
pf.file_name
from OPB_SESS_FILE_VALS pf
inner join OPB_session s on pf.session_id = s.session_id
inner join OPB_mapping m on m.mapping_id = s.mapping_id
inner join OPB_subject f on m.subject_id = f.subj_id
inner join OPB_task t on t.task_id = s.session_id
inner join OPB_task wf on t.ru_parent_id = wf.task_id
where file_name like '%.pf%' 
order by 1,2,3,4,5





select wn.task_name,s.run_options,end_options,s.*
from OPB_SCHEDULER s
inner join OPB_workflow w on s.scheduler_id = w.scheduler_id
inner join OPB_task wn on wn.task_id = w.workflow_id
where s.subject_id = 238
and (s.run_options in (3,4,20)
and delta_value = 86400
or s.run_options = 8)


4 - run every
20 - run every and run on integration service restart
5 - run on demand
2 - run once
3 - run on demand
8 - customized repeat
36 - run continuously


select 
f.subj_name Folder,
wf.task_name as Workflow,
ew.task_name as Ewent_Wait,
ewa.attr_value Event_Wait_File
from OPB_TASK ew
inner join OPB_task wf on ew.ru_parent_id = wf.task_id
inner join OPB_TASK_ATTR ewa on ewa.task_id = ew.task_id
inner join OPB_subject f on ew.subject_id = f.subj_id
where ew.subject_id = 238
and ewa.task_type = 60
and ewa.attr_id = 4
and ewa.attr_value = '/etl1/infa/IndicatFiles/email_opt_out.ind'


-- Query to search something in the SQ SQL, LKP SQL, Expression, Filter, Update Override


select * from (
select 
d.subj_name FolderName,
g.task_name WorkflowName,
f.task_name SessionName,
c.mapping_name MappingName,
case to_char(a.widget_type)
when '3' then 'Source Qualifier SQL'
when '10' then 'Filter Condition'
when '11' then 'Lookup Override'
end Type,
b.widget_name FilterName,
a.attr_value Search
from OPB_WIDGET_ATTR a
inner join OPB_WIDGET b on a.widget_id = b.widget_id
inner join OPB_mapping c on b.ru_parent_id = c.mapping_id
inner join OPB_subject d on c.subject_id = d.subj_id
inner join OPB_session e on c.mapping_id = e.mapping_id
inner join OPB_task f on e.session_id = f.task_id
inner join OPB_task g on f.ru_parent_id = g.task_id
where a.widget_type in (3,10,11)

union

select 
d.subj_name FolderName,
g.task_name WorkflowName,
f.task_name SessionName,
c.mapping_name MappingName,
'Update Override' as Type,
b.instance_name Transformation,
a.attr_value UpdateOverride
from OPB_WIDGET_ATTR a
inner join OPB_WIDGET_INST b on a.widget_id = b.widget_id and a.mapping_id = b.mapping_id and a.instance_id = b.instance_id
inner join OPB_mapping c on a.mapping_id = c.mapping_id
inner join OPB_subject d on c.subject_id = d.subj_id
inner join OPB_session e on c.mapping_id = e.mapping_id
inner join OPB_task f on e.session_id = f.task_id
inner join OPB_task g on f.ru_parent_id = g.task_id
where a.widget_type = 2

union

select 
e.subj_name FolderName,
h.task_name WorkflowName,
g.task_name SessionName,
d.mapping_name MappingName,
case to_char(c.widget_type)
when '5' then 'Expression'
when '9' then 'Aggregator'
end Type,
c.widget_name Transformation,
b.Expression Expression
from OPB_WIDGET_EXPR a
inner join OPB_EXPRESSION b on a.widget_id = b.widget_id and a.expr_id = b.expr_id
inner join OPB_WIDGET c on a.widget_id = c.widget_id
inner join OPB_mapping d on c.ru_parent_id = d.mapping_id
inner join OPB_subject e on d.subject_id = e.subj_id
inner join OPB_session f on d.mapping_id = f.mapping_id
inner join OPB_task g on f.session_id = g.task_id
inner join OPB_task h on g.ru_parent_id = h.task_id
where c.widget_type in (5,9)

union

select 
d.subj_name FolderName,
g.task_name WorkflowName,
f.task_name SessionName,
c.mapping_name RouterName,
'Router Groups Condition' Type,
b.widget_name FilterName,
a.attr_value Search
from OPB_TABLE_GROUP a
inner join OPB_WIDGET b on a.object_id = b.widget_id
inner join OPB_mapping c on b.ru_parent_id = c.mapping_id
inner join OPB_subject d on c.subject_id = d.subj_id
inner join OPB_session e on c.mapping_id = e.mapping_id
inner join OPB_task f on e.session_id = f.task_id
inner join OPB_task g on f.ru_parent_id = g.task_id
where a.object_type = 15
and attr_id = 3
) a 
where upper(Search) like upper('%999999998%')
order by 1,2,3,4,5,6


-- Impact Analysis SQL for a field 


SELECT DISTINCT
COMPLETE_LIST.FOLDER,COMPLETE_LIST.WORKFLOW_NAME,COMPLETE_LIST.SESSION_NAME,COMPLETE_LIST.MAPPING_NAME,COMPLETE_LIST.TABLE_NAME,
COMPLETE_LIST.INSTANCE_NAME,COMPLETE_LIST.CONNECTION_NAME,COMPLETE_LIST.CONNECTION_STRING,COMPLETE_LIST.TYPE,FIELD_NAME
FROM 
(
(SELECT
SUB.SUBJ_NAME AS FOLDER, WF_TASK.TASK_NAME AS WORKFLOW_NAME,SESS_TASK.TASK_NAME AS SESSION_NAME,M.MAPPING_NAME AS MAPPING_NAME,
SRC.SOURCE_NAME TABLE_NAME,'SOURCEINSTANCE NAME' AS INSTANCE_NAME,CNX.OBJECT_NAME AS CONNECTION_NAME,CNX.CONNECT_STRING AS CONNECTION_STRING,
'SOURCE' AS TYPE,SRCFLD.SRC_NAME AS FIELD_NAME
FROM
OPB_CNX  CNX,
OPB_SESS_CNX_VALS CV,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 68) SESS_TASK,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 71) WF_TASK,
OPB_SUBJECT SUB,
(
SELECT DISTINCT
SCV.SESSION_ID, SCV.CONNECTION_ID, SCV.SESS_WIDG_INST_ID, SE.OBJECT_TYPE
FROM OPB_SESS_CNX_VALS SCV, OPB_SESS_EXTNS SE
WHERE SE.SESSION_ID = SCV.SESSION_ID AND SE.SESS_WIDG_INST_ID = SCV.SESS_WIDG_INST_ID 
) SC,
OPB_SESSION S,
OPB_MAPPING M,
(SELECT DISTINCT SESSION_ID, WIDGET_ID, WIDGET_TYPE, SESS_WIDG_INST_ID FROM  OPB_SWIDGET_INST) SI,
OPB_WIDGET W,
OPB_DBDS MD,
OPB_DBD D,
OPB_SRC SRC,
OPB_SRC_FLD SRCFLD
WHERE
CV.CONNECTION_ID =  CNX.OBJECT_ID
AND CV.SESSION_ID = SESS_TASK.TASK_ID
AND SESS_TASK.RU_PARENT_ID = WF_TASK.TASK_ID
AND SESS_TASK.SUBJECT_ID = SUB.SUBJ_ID
AND SC.SESSION_ID = SESS_TASK.TASK_ID
AND SC.CONNECTION_ID = CNX.OBJECT_ID
AND SC.OBJECT_TYPE = 78
AND S.SESSION_ID = SESS_TASK.TASK_ID
AND M.MAPPING_ID = S.MAPPING_ID
AND SI.SESSION_ID = SESS_TASK.TASK_ID
AND SI.WIDGET_TYPE = 3
AND SC.SESS_WIDG_INST_ID = SI.SESS_WIDG_INST_ID
AND CV.SESS_WIDG_INST_ID = SC.SESS_WIDG_INST_ID
AND W.WIDGET_ID = SI.WIDGET_ID
AND M.MAPPING_ID = MD.MAPPING_ID
AND MD.DBD_ID = D.DBDID
AND D.ROOTID = SRC.SRC_ID
AND SRC.SRC_ID = SRCFLD.SRC_ID
AND UPPER(SUB.SUBJ_NAME) NOT LIKE  '%RECOVERY%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%OLD%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%RLDM%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%/%/%'
)
UNION
(
SELECT 
SUB.SUBJ_NAME AS FOLDER, WF_TASK.TASK_NAME AS WORKFLOW_NAME,SESS_TASK.TASK_NAME AS SESSION_NAME,M.MAPPING_NAME AS MAPPING_NAME,TGT.TARGET_NAME AS TABLE_NAME,
'TARGET INSTANCE NAME' AS INSTANCE_NAME,CNX.OBJECT_NAME AS CONNECTION_NAME,CNX.CONNECT_STRING AS CONNECTION_STRING,'TARGET' AS TYPE,TGTFLD.TARGET_NAME

FROM
OPB_CNX CNX,
OPB_SESS_CNX_VALS CV,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 68) SESS_TASK,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 71) WF_TASK,
OPB_SUBJECT SUB,
(
SELECT DISTINCT
SCV.SESSION_ID, SCV.CONNECTION_ID, SCV.SESS_WIDG_INST_ID, SE.OBJECT_TYPE
FROM OPB_SESS_CNX_VALS SCV, OPB_SESS_EXTNS SE
WHERE SE.SESSION_ID = SCV.SESSION_ID AND SE.SESS_WIDG_INST_ID = SCV.SESS_WIDG_INST_ID 
) SC,
OPB_SESSION S,
OPB_MAPPING M,
OPB_WIDGET_INST WM,
OPB_TARG TGT,
OPB_TARG_FLD TGTFLD

WHERE
CV.CONNECTION_ID =  CNX.OBJECT_ID
AND CV.SESSION_ID = SESS_TASK.TASK_ID
AND SESS_TASK.RU_PARENT_ID = WF_TASK.TASK_ID
AND SESS_TASK.SUBJECT_ID = SUB.SUBJ_ID
AND SC.SESSION_ID = SESS_TASK.TASK_ID
AND SC.CONNECTION_ID = CNX.OBJECT_ID
AND SC.OBJECT_TYPE = 79
AND S.SESSION_ID = SESS_TASK.TASK_ID
AND M.MAPPING_ID = S.MAPPING_ID
AND WM.MAPPING_ID = M.MAPPING_ID
AND WM.WIDGET_TYPE = 2 --TARGET
AND WM.WIDGET_ID = TGT.TARGET_ID
AND TGTFLD.TARGET_ID = TGT.TARGET_ID
AND UPPER(SUB.SUBJ_NAME) NOT LIKE  '%RECOVERY%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%OLD%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%RLDM%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%/%/%'
)
UNION  
(
SELECT
SUB.SUBJ_NAME AS FOLDER,B.TASK_NAME AS WORKFLOW_NAME,A.TASK_NAME AS SESSION_NAME ,M.MAPPING_NAME AS MAPPING_NAME,ATTR.ATTR_VALUE AS TABLE_NAME,
W.INSTANCE_NAME AS INSTANCE_NAME,CNX.OBJECT_NAME AS CONNECTION_NAME,CNX.CONNECT_STRING AS CONNECTION_STRING,'LOOKUP' AS TYPE,WF.FIELD_NAME
FROM 
OPB_MAPPING M, 
OPB_SWIDGET_INST W,
OPB_SESSION S,
OPB_TASK A,
OPB_TASK B, 
OPB_SUBJECT SUB,
OPB_CNX CNX, 
OPB_SESS_CNX_VALS V,
(SELECT WIDGET_ID,ATTR_VALUE FROM OPB_WIDGET_ATTR WHERE WIDGET_TYPE = 11 AND ATTR_ID = 2) ATTR,
OPB_WIDGET_FIELD WF

WHERE 
M.MAPPING_ID = W.MAPPING_ID
AND S.MAPPING_ID = M.MAPPING_ID
AND A.TASK_ID = S.SESSION_ID
AND B.TASK_ID = A.RU_PARENT_ID
AND A.TASK_ID = S.SESSION_ID
AND SUB.SUBJ_ID=M.SUBJECT_ID 
AND W.SESSION_ID = S.SESSION_ID
AND W.SESS_WIDG_INST_ID = V.SESS_WIDG_INST_ID
AND V.SESSION_ID = S.SESSION_ID
AND V.CONNECTION_ID = CNX.OBJECT_ID
AND ATTR.WIDGET_ID = W.WIDGET_ID
AND W.WIDGET_ID = WF.WIDGET_ID
AND W.WIDGET_ID IN   
(SELECT DISTINCT  OPB_SWIDGET_INST.WIDGET_ID
 FROM OPB_SWIDGET_INST ,OPB_TASK,
OPB_SESS_EXTNS,OPB_SESS_CNX_REFS,OPB_CNX
 WHERE OPB_SWIDGET_INST.WIDGET_TYPE=11
AND OPB_SWIDGET_INST.SESSION_ID = OPB_SESS_EXTNS.SESSION_ID 
AND OPB_SWIDGET_INST.SESS_WIDG_INST_ID = OPB_SESS_EXTNS.SESS_WIDG_INST_ID 
AND OPB_SESS_EXTNS.SESSION_ID = OPB_SESS_CNX_REFS.SESSION_ID 
AND OPB_SESS_CNX_REFS.REF_OBJECT_TYPE = OPB_CNX.OBJECT_TYPE 
AND OPB_SESS_CNX_REFS.REF_OBJECT_SUBTYP = OPB_CNX.OBJECT_SUBTYPE 
AND OPB_SESS_CNX_REFS.REF_OBJECT_ID  = OPB_CNX.OBJECT_ID
AND OPB_TASK.TASK_ID = OPB_SWIDGET_INST.SESSION_ID
AND OPB_TASK.TASK_TYPE = 68)

AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%RECOVERY%'
AND SUB.SUBJ_NAME NOT LIKE '%OLD%'
AND SUB.SUBJ_NAME NOT LIKE '%RLDM%'
AND UPPER(B.TASK_NAME) NOT LIKE '%RECOVERY%'
)
)COMPLETE_LIST
WHERE 
UPPER(COMPLETE_LIST.FIELD_NAME) LIKE '%TEND_ACCT_ID%'  /* HERE U CAN GIVE THE INPUT TABLE NAME */
ORDER BY 
COMPLETE_LIST.FOLDER,COMPLETE_LIST.WORKFLOW_NAME,COMPLETE_LIST.SESSION_NAME,COMPLETE_LIST.MAPPING_NAME,COMPLETE_LIST.TABLE_NAME,COMPLETE_LIST.TYPE, FIELD_NAME


-- Get list of all mappings which use XML as target


select distinct 
s.subj_name,
wf.task_name,
m.mapping_name,
ss.task_name
from OPB_TARG T
inner join OPB_WIDGET_INST wi on t.target_id = wi.WIDGET_ID
inner join OPB_mapping m on wi.mapping_id = m.mapping_id
inner join OPB_subject s on s.subj_id = m.subject_id
inner join OPB_session sess on sess.mapping_id = m.mapping_id
inner join OPB_task ss on sess.session_id = ss.task_id and ss.task_type = 68
inner join OPB_task wf on wf.task_id = ss.ru_parent_id and wf.task_type = 71
where subj_name = ''
and wf.task_name = ''
and t.target_name = ''
order by 1,2,3,4



select distinct 
s.subj_name Folder,
wf.task_name Workflow,
ss.task_name Session_,
m.mapping_name Mapping_,
ea.attr_value XMLFile
from OPB_mapping m 
inner join OPB_subject s on s.subj_id = m.subject_id
inner join OPB_session sess on sess.mapping_id = m.mapping_id
inner join OPB_task ss on sess.session_id = ss.task_id and ss.task_type = 68
inner join OPB_task wf on wf.task_id = ss.ru_parent_id and wf.task_type = 71
inner join OPB_extn_attr ea on ea.session_id  = ss.task_id
where upper(ea.attr_value) like '%%'
order by 1,2,3,4



-- Search based on XML file name


select distinct 
s.subj_name Folder,
wf.task_name Workflow,
ss.task_name "Session",
m.mapping_name "Mapping",
ea.attr_value XMLFileName
from OPB_mapping m
inner join OPB_subject s on s.subj_id = m.subject_id
inner join OPB_session sess on sess.mapping_id = m.mapping_id
inner join OPB_task ss on sess.session_id = ss.task_id and ss.task_type = 68
inner join OPB_task wf on wf.task_id = ss.ru_parent_id and wf.task_type = 71
inner join OPB_SWIDGET_INST si on sess.session_id = si.session_id
inner join OPB_EXTN_ATTR ea on si.session_id = ea.session_id and si.sess_widg_inst_id = ea.sess_widg_inst_id
where ea.attr_id = 2
and upper(ea.attr_value) like upper('%%')
order by 1,2,3,4,5

Task Type :

58.00 pre/post session command
59.00 
60.00 event wait
62.00 start
65.00 on success email
66.00 timer
67.00 assignment
68.00 session 
70.00 worklet
71.00 workflow


Mapplets :

select count(1) from OPB_widget
where widget_type = 44



-- tablename impact analysis


SELECT DISTINCT
COMPLETE_LIST.FOLDER,COMPLETE_LIST.WORKFLOW_NAME,COMPLETE_LIST.SESSION_NAME,COMPLETE_LIST.MAPPING_NAME,COMPLETE_LIST.TABLE_NAME,
COMPLETE_LIST.INSTANCE_NAME,COMPLETE_LIST.CONNECTION_NAME,COMPLETE_LIST.CONNECTION_STRING,COMPLETE_LIST.TYPE
FROM 
(
(SELECT
SUB.SUBJ_NAME AS FOLDER, WF_TASK.TASK_NAME AS WORKFLOW_NAME,SESS_TASK.TASK_NAME AS SESSION_NAME,M.MAPPING_NAME AS MAPPING_NAME,
SRC.SOURCE_NAME TABLE_NAME,'SOURCEINSTANCE NAME' AS INSTANCE_NAME,CNX.OBJECT_NAME AS CONNECTION_NAME,CNX.CONNECT_STRING AS CONNECTION_STRING,
'SOURCE' AS TYPE
FROM
OPB_CNX  CNX,
OPB_SESS_CNX_VALS CV,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 68) SESS_TASK,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 71) WF_TASK,
OPB_SUBJECT SUB,
(
SELECT DISTINCT
SCV.SESSION_ID, SCV.CONNECTION_ID, SCV.SESS_WIDG_INST_ID, SE.OBJECT_TYPE
FROM OPB_SESS_CNX_VALS SCV, OPB_SESS_EXTNS SE
WHERE SE.SESSION_ID = SCV.SESSION_ID AND SE.SESS_WIDG_INST_ID = SCV.SESS_WIDG_INST_ID 
) SC,
OPB_SESSION S,
OPB_MAPPING M,
(SELECT DISTINCT SESSION_ID, WIDGET_ID, WIDGET_TYPE, SESS_WIDG_INST_ID FROM  OPB_SWIDGET_INST) SI,
OPB_WIDGET W,
OPB_DBDS MD,
OPB_DBD D,
OPB_SRC SRC
WHERE
CV.CONNECTION_ID =  CNX.OBJECT_ID
AND CV.SESSION_ID = SESS_TASK.TASK_ID
AND SESS_TASK.RU_PARENT_ID = WF_TASK.TASK_ID
AND SESS_TASK.SUBJECT_ID = SUB.SUBJ_ID
AND SC.SESSION_ID = SESS_TASK.TASK_ID
AND SC.CONNECTION_ID = CNX.OBJECT_ID
AND SC.OBJECT_TYPE = 78
AND S.SESSION_ID = SESS_TASK.TASK_ID
AND M.MAPPING_ID = S.MAPPING_ID
AND SI.SESSION_ID = SESS_TASK.TASK_ID
AND SI.WIDGET_TYPE = 3
AND SC.SESS_WIDG_INST_ID = SI.SESS_WIDG_INST_ID
AND CV.SESS_WIDG_INST_ID = SC.SESS_WIDG_INST_ID
AND W.WIDGET_ID = SI.WIDGET_ID
AND M.MAPPING_ID = MD.MAPPING_ID
AND MD.DBD_ID = D.DBDID
AND D.ROOTID = SRC.SRC_ID
AND UPPER(SUB.SUBJ_NAME) NOT LIKE  '%RECOVERY%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%OLD%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%RLDM%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%/%/%'
)
UNION
(
SELECT 
SUB.SUBJ_NAME AS FOLDER, WF_TASK.TASK_NAME AS WORKFLOW_NAME,SESS_TASK.TASK_NAME AS SESSION_NAME,M.MAPPING_NAME AS MAPPING_NAME,TGT.TARGET_NAME AS TABLE_NAME,
'TARGET INSTANCE NAME' AS INSTANCE_NAME,CNX.OBJECT_NAME AS CONNECTION_NAME,CNX.CONNECT_STRING AS CONNECTION_STRING,'TARGET' AS TYPE

FROM
OPB_CNX CNX,
OPB_SESS_CNX_VALS CV,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 68) SESS_TASK,
(SELECT * FROM OPB_TASK WHERE TASK_TYPE = 71) WF_TASK,
OPB_SUBJECT SUB,
(
SELECT DISTINCT
SCV.SESSION_ID, SCV.CONNECTION_ID, SCV.SESS_WIDG_INST_ID, SE.OBJECT_TYPE
FROM OPB_SESS_CNX_VALS SCV, OPB_SESS_EXTNS SE
WHERE SE.SESSION_ID = SCV.SESSION_ID AND SE.SESS_WIDG_INST_ID = SCV.SESS_WIDG_INST_ID 
) SC,
OPB_SESSION S,
OPB_MAPPING M,
OPB_WIDGET_INST WM,
OPB_TARG TGT

WHERE
CV.CONNECTION_ID =  CNX.OBJECT_ID
AND CV.SESSION_ID = SESS_TASK.TASK_ID
AND SESS_TASK.RU_PARENT_ID = WF_TASK.TASK_ID
AND SESS_TASK.SUBJECT_ID = SUB.SUBJ_ID
AND SC.SESSION_ID = SESS_TASK.TASK_ID
AND SC.CONNECTION_ID = CNX.OBJECT_ID
AND SC.OBJECT_TYPE = 79
AND S.SESSION_ID = SESS_TASK.TASK_ID
AND M.MAPPING_ID = S.MAPPING_ID
AND WM.MAPPING_ID = M.MAPPING_ID
AND WM.WIDGET_TYPE = 2 --TARGET
AND WM.WIDGET_ID = TGT.TARGET_ID
AND UPPER(SUB.SUBJ_NAME) NOT LIKE  '%RECOVERY%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%OLD%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%RLDM%'
AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%/%/%')
UNION  
(
SELECT
SUB.SUBJ_NAME AS FOLDER,B.TASK_NAME AS WORKFLOW_NAME,A.TASK_NAME AS SESSION_NAME ,M.MAPPING_NAME AS MAPPING_NAME,ATTR.ATTR_VALUE AS TABLE_NAME,
W.INSTANCE_NAME AS INSTANCE_NAME,CNX.OBJECT_NAME AS CONNECTION_NAME,CNX.CONNECT_STRING AS CONNECTION_STRING,'LOOKUP' AS TYPE
FROM 
OPB_MAPPING M, 
OPB_SWIDGET_INST W,
OPB_SESSION S,
OPB_TASK A,
OPB_TASK B, 
OPB_SUBJECT SUB,
OPB_CNX CNX, 
OPB_SESS_CNX_VALS V,
(SELECT WIDGET_ID,ATTR_VALUE FROM OPB_WIDGET_ATTR WHERE WIDGET_TYPE = 11 AND ATTR_ID = 2) ATTR

WHERE 
M.MAPPING_ID = W.MAPPING_ID
AND S.MAPPING_ID = M.MAPPING_ID
AND A.TASK_ID = S.SESSION_ID
AND B.TASK_ID = A.RU_PARENT_ID
AND A.TASK_ID = S.SESSION_ID
AND SUB.SUBJ_ID=M.SUBJECT_ID 
AND W.SESSION_ID = S.SESSION_ID
AND W.SESS_WIDG_INST_ID = V.SESS_WIDG_INST_ID
AND V.SESSION_ID = S.SESSION_ID
AND V.CONNECTION_ID = CNX.OBJECT_ID
AND ATTR.WIDGET_ID = W.WIDGET_ID

AND W.WIDGET_ID IN   
(SELECT DISTINCT  OPB_SWIDGET_INST.WIDGET_ID
 FROM OPB_SWIDGET_INST ,OPB_TASK,
OPB_SESS_EXTNS,OPB_SESS_CNX_REFS,OPB_CNX
 WHERE OPB_SWIDGET_INST.WIDGET_TYPE=11
AND OPB_SWIDGET_INST.SESSION_ID = OPB_SESS_EXTNS.SESSION_ID 
AND OPB_SWIDGET_INST.SESS_WIDG_INST_ID = OPB_SESS_EXTNS.SESS_WIDG_INST_ID 
AND OPB_SESS_EXTNS.SESSION_ID = OPB_SESS_CNX_REFS.SESSION_ID 
AND OPB_SESS_CNX_REFS.REF_OBJECT_TYPE = OPB_CNX.OBJECT_TYPE 
AND OPB_SESS_CNX_REFS.REF_OBJECT_SUBTYP = OPB_CNX.OBJECT_SUBTYPE 
AND OPB_SESS_CNX_REFS.REF_OBJECT_ID  = OPB_CNX.OBJECT_ID
AND OPB_TASK.TASK_ID = OPB_SWIDGET_INST.SESSION_ID
AND OPB_TASK.TASK_TYPE = 68)

AND UPPER(SUB.SUBJ_NAME) NOT LIKE '%RECOVERY%'
AND SUB.SUBJ_NAME NOT LIKE '%OLD%'
AND SUB.SUBJ_NAME NOT LIKE '%RLDM%'
AND UPPER(B.TASK_NAME) NOT LIKE '%RECOVERY%'
)
)COMPLETE_LIST
WHERE 
UPPER(COMPLETE_LIST.TABLE_NAME) LIKE 'POS_ITMS'  /* HERE U CAN GIVE THE INPUT TABLE NAME */
ORDER BY 
COMPLETE_LIST.FOLDER,COMPLETE_LIST.WORKFLOW_NAME,COMPLETE_LIST.SESSION_NAME,COMPLETE_LIST.MAPPING_NAME,COMPLETE_LIST.TABLE_NAME,COMPLETE_LIST.TYPE


-- To get the details of "Components" tab of a session

OPB_COMPONENT

REF_OBJECT_ID is linked to TASK_ID (pre session-post session command/email/variable assignments)

select 
C.SUBJ_NAME "Folder",
B.TASK_NAME "Workflow",
a.TASK_NAME "Session",
E.TASK_NAME "post_session_email"
from OPB_TASK A 
inner join OPB_TASK B on a.RU_PARENT_ID=B.TASK_ID and a.TASK_TYPE = 68
inner join OPB_SUBJECT C on B.SUBJect_ID = C.SUBj_ID
inner join OPB_COMPONENT D on a.TASK_ID = D.TASK_ID
inner join OPB_TASK E on d.ref_obj_id = e.task_id
where C.SUBJ_NAME=''
and B.TASK_NAME like '%%'
and d.object_type = 65 -- email
order by 1,2,3,4

select 
C.SUBJ_NAME "Folder",
B.TASK_NAME "Workflow",
a.TASK_NAME "Session",
E.PM_VALUE "pre-post_session_command"
from OPB_TASK A 
inner join OPB_TASK B on a.RU_PARENT_ID=B.TASK_ID and a.TASK_TYPE = 68
inner join OPB_SUBJECT C on B.SUBJect_ID = C.SUBj_ID
inner join OPB_COMPONENT D on a.TASK_ID = D.TASK_ID
inner join OPB_TASK_VAL_LIST E on D.REF_OBJ_ID = E.TASK_ID
where C.SUBJ_NAME='TDM_CMDM'
and B.TASK_NAME like '%%'
and d.object_type = 58
order by 1,2,3,4



SELECT
W.TASK_NAME WORKFLOW_NAME,
S.TASK_NAME SESSION_NAME,
CASE WHEN SP.ATTR_VALUE = 0 THEN 'Insert'
     WHEN SP.ATTR_VALUE = 1 THEN 'Delete'
     WHEN SP.ATTR_VALUE = 2 THEN 'Update'
     WHEN SP.ATTR_VALUE = 3 THEN 'Data Driven'
END AS "Treat source rows as"
FROM OPB_TASK W
INNER JOIN OPB_TASK S ON W.TASK_ID = S.RU_PARENT_ID
inner join OPB_TASK_ATTR SP on s.task_id = sp.task_id
WHERE W.SUBJECT_ID = 46
AND s.SUBJECT_ID = 46
AND W.TASK_TYPE = 71
AND S.TASK_TYPE = 68
AND SP.TASK_TYPE = 68
AND ATTR_ID = 9
and w.task_name like '%'
ORDER BY 1,2



-- Check if a task is enabled/disabled

SELECT
F.SUBJ_NAME FOLDER,
W.TASK_NAME WORKFLOW,
C.TASK_NAME COMMAND_TASK,
CASE WHEN CI.IS_ENABLED = 1 THEN 'Enabled'
ELSE 'Disabled' END AS ENABLED
FROM OPB_SUBJECT F
INNER JOIN OPB_TASK W ON F.SUBJ_ID = W.SUBJECT_ID
INNER JOIN OPB_TASK C ON W.TASK_ID = C.RU_PARENT_ID
INNER JOIN OPB_TASK_INST CI ON C.TASK_ID = CI.TASK_ID
WHERE F.SUBJ_NAME = ''
AND W.TASK_NAME LIKE '%'
AND W.TASK_TYPE = 71
AND C.TASK_TYPE = 58
ORDER BY 1,2,3


-- Check the session level SQL override for a session

SELECT
F.SUBJ_NAME FOLDER,
W.TASK_NAME WORKFLOW,
S.TASK_NAME SESSION_,
SA.ATTR_VALUE SQL_OVERRIDE
FROM OPB_SUBJECT F
INNER JOIN OPB_TASK W ON F.SUBJ_ID = W.SUBJECT_ID
INNER JOIN OPB_TASK S ON W.TASK_ID = S.RU_PARENT_ID
INNER JOIN OPB_SWIDGET_ATTR SA ON S.TASK_ID = SA.SESSION_ID
WHERE F.SUBJ_NAME = ''
AND W.TASK_TYPE = 71
AND S.TASK_TYPE = 68
AND S.TASK_NAME IN (
''
)
AND SA.ATTR_ID = 1
ORDER BY 1,2,3,SA.PARTITION_ID




-- Average run time

SELECT A.SUBJECT_AREA as Folder, A.WORKFLOW_NAME, B.TASK_NAME AS WORKLET_name,
to_char(b.start_time,'MM/DD/YYYY HH24:MI:SS') START_TIME,
to_char(b.END_time,'MM/DD/YYYY HH24:MI:SS') END_TIME,
round((b.END_TIME - b.START_TIME) * (60 * 24),2) TIME_TAKEN
FROM REP_WFLOW_RUN A, opb_task_inst_run B
where A.WORKFLOW_NAME = '
and a.subject_id = b.subject_id
and a.workflow_id = b.workflow_id
and a.workflow_run_id = b.workflow_run_id
ORDER BY B.START_TIME;


